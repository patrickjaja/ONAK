{"version":3,"sources":["class.mysql.js"],"names":[],"mappings":";;;;;;;;;;;;;;;qBAGkB,OAAO;;;;iCACX,yBAAyB;;;;6CACd,qCAAqC;;;;IAEjD,KAAK;AACH,aADF,KAAK,GACqD;YAAvD,IAAI,yDAAC,WAAW;YAAE,MAAM,yDAAC,EAAE;YAAE,IAAI,yDAAC,MAAM;YAAE,QAAQ,yDAAC,EAAE;;8BADxD,KAAK;;AAEV,YAAI,CAAC,MAAM,GAAC,MAAM,CAAC;AACnB,YAAI,CAAC,IAAI,GAAC,IAAI,CAAC;AACf,YAAI,CAAC,IAAI,GAAC,IAAI,CAAC;AACf,YAAI,CAAC,QAAQ,GAAC,QAAQ,CAAC;AACvB,YAAI,CAAC,eAAe,GAAG,EAAE,CAAC;AAC1B,YAAI,CAAC,OAAO,EAAE,CAAC;KAClB;;iBARQ,KAAK;;eASP,mBAAG;AACN,gBAAI,CAAC,IAAI,GAAI,mBAAM,UAAU,CAAC;AAC1B,+BAAe,EAAG,IAAI,CAAC,eAAe;AACtC,oBAAI,EAAc,IAAI,CAAC,IAAI;AAC3B,oBAAI,EAAc,IAAI,CAAC,IAAI;AAC3B,wBAAQ,EAAU,IAAI,CAAC,QAAQ;AAC/B,wBAAQ,EAAU,IAAI,CAAC,MAAM;aAChC,CAAC,CAAC;;AAEH,gBAAI,CAAC,WAAW,EAAE,CAAC;;AAEnB,gBAAI,CAAC,gBAAgB,EAAE,CAAC;;AAExB,gBAAI,CAAC,IAAI,CAAC,aAAa,CAAC,UAAS,GAAG,EAAE,UAAU,EAAE;AAC9C,oBAAI,GAAG,EAAE;AACL,mEAAiB,GAAG,CAAC,CAAC;iBACzB;AACD,oBAAI,CAAC,UAAU,GAAC,UAAU,CAAC;aAC9B,CAAC,CAAC;SACN;;;eACU,uBAAG;AACV,gBAAI,CAAC,IAAI,CAAC,EAAE,CAAC,YAAY,EAAE,UAAU,UAAU,EAAE;AAC7C,+CAAE,GAAG,CAAC,oBAAoB,CAAC,CAAC;aAC/B,CAAC,CAAC;AACH,gBAAI,CAAC,IAAI,CAAC,EAAE,CAAC,SAAS,EAAE,YAAY;AAChC,+CAAE,GAAG,CAAC,uCAAuC,CAAC,CAAC;aAClD,CAAC,CAAC;SACN;;;eACe,4BAAG;AACf,gBAAI,CAAC,IAAI,CAAC,MAAM,CAAC,WAAW,GAAG,UAAU,KAAK,EAAE,MAAM,EAAE;AACpD,oBAAI,CAAC,MAAM,EAAE,OAAO,KAAK,CAAC;AAC1B,uBAAO,KAAK,CAAC,OAAO,CAAC,UAAU,EAAE,CAAA,UAAU,GAAG,EAAE,GAAG,EAAE;AACjD,wBAAI,MAAM,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;AAC5B,+BAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;qBACnC;AACD,2BAAO,GAAG,CAAC;iBACd,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;aACjB,CAAC;SACL;;;eACM,iBAAC,KAAK,EAAE;;SAEd;;;eACM,mBAAoD;gBAAnD,KAAK,yDAAC,qBAAqB;gBAAE,MAAM,yDAAC,EAAC,KAAK,EAAC,KAAK,EAAC;;AACrD,gBAAI,CAAC,UAAU,CAAC,KAAK,CAAC,KAAK,EAAE,MAAM,EAAE,UAAS,GAAG,EAAE,MAAM,EAAE;AACvD,oBAAI,GAAG,EAAE;AACL,mEAAiB,GAAG,CAAC,CAAC;iBACzB;AACD,+CAAE,GAAG,CAAC,MAAM,EAAC,MAAM,CAAC,CAAC;aACxB,CAAC,CAAC;;;;;AAKH,gBAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC;SAC7B;;;WA/DQ,KAAK","file":"class.mysql-compiled.js","sourcesContent":["/**\r\n * Created by root on 30.08.2015.\r\n */\r\nimport mysql from 'mysql'\r\nimport l from '../LOG/class.logging.js'\r\nimport sqlException from '../EXCEPTIONS/class.sqlException.js'\r\n\r\nexport class MYSQL {\r\n    constructor(host=\"localhost\", dbname=\"\", user=\"root\", password=\"\") {\r\n        this.dbname=dbname;\r\n        this.host=host;\r\n        this.user=user;\r\n        this.password=password;\r\n        this.connectionLimit = 10;\r\n        this.connect();\r\n    }\r\n    connect() {\r\n        this.pool  = mysql.createPool({\r\n            connectionLimit : this.connectionLimit,\r\n            host            : this.host,\r\n            user            : this.user,\r\n            password        : this.password,\r\n            database        : this.dbname\r\n        });\r\n\r\n        this._bindEvents();\r\n\r\n        this._applyPoolConfig();\r\n\r\n        this.pool.getConnection(function(err, connection) {\r\n            if (err) {\r\n                new sqlException(err);\r\n            }\r\n            this.connection=connection;\r\n        });\r\n    }\r\n    _bindEvents() {\r\n        this.pool.on('connection', function (connection) {\r\n            l.log(\"Database connected\");\r\n        });\r\n        this.pool.on('enqueue', function () {\r\n            l.log('Waiting for available connection slot');\r\n        });\r\n    }\r\n    _applyPoolConfig() {\r\n        this.pool.config.queryFormat = function (query, values) {\r\n            if (!values) return query;\r\n            return query.replace(/\\:(\\w+)/g, function (txt, key) {\r\n                if (values.hasOwnProperty(key)) {\r\n                    return this.escape(values[key]);\r\n                }\r\n                return txt;\r\n            }.bind(this));\r\n        };\r\n    }\r\n    prepSQL(query) {\r\n        //2bd\r\n    }\r\n    sendSQL(query=\"SELECT * FROM table\", values={param:\"val\"}) {\r\n        this.connection.query(query, values, function(err, result) {\r\n            if (err) {\r\n                new sqlException(err);\r\n            }\r\n            l.log(\"GOGO\",result);\r\n        });\r\n        //this.connection.query(\"SELECT * FROM `users` WHERE username = :title\", { title: \"test1\" }, function(err, result) {\r\n        //    if (err) throw err;\r\n        //    console.log(\"GOGO\",result);\r\n        //});\r\n        this.connection.release();\r\n    }\r\n}"]}